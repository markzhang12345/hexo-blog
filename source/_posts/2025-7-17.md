---
title: "Tauri å®‰å“è¸©å‘ç¬”è®°"
date: 2025-7-17 11:43:47
tags: [Web, Tauri, Android]
categories: æ‚è°ˆ
toc: true
cover: /images/2025-7-17/thumb-440-1352244.webp
---

# Tauri å®‰å“è¸©å‘æ—¥è®°

ç®€å•è®°å½•ä¸€ä¸‹ä½¿ç”¨ Tauri 2.0 å¼€å‘å®‰å“åº”ç”¨è¸©çš„å°å‘

## æ‰“åŒ…ç­¾å apk

å®˜ç½‘ä¸Šå…¶å®å†™çš„å¾ˆæ¸…æ¥šï¼Œä½†æ˜¯å°±æ˜¯æœ‰ä¸¤ä¸ª ğŸ– çœ¼ç›çäº†

![img](../images/2025-7-17/5c04b5d9bc3eb13564b908aae01ea8d3fd1f44b1.jpg)

é¦–å…ˆä½ è¦æœ‰ä¸€ä¸ªå¯†é’¥åº“ï¼Œå¯ä»¥é€šè¿‡ Android Studio ç”Ÿæˆå¯†é’¥ï¼Œä¹Ÿå¯ä»¥ç”¨ keytool ç”Ÿæˆï¼Œè¿™é‡Œæˆ‘ä»¬é€šè¿‡å‘½ä»¤è¡Œä½¿ç”¨ keytool

```powershell
keytool -genkey -v -keystore $env:USERPROFILE\upload-keystore.jks -storetype JKS -keyalg RSA -keysize 2048 -validity 10000 -alias upload
```

> ä½ çš„ keytool å®‰è£…åœ¨ Android Studio é™„å¸¦çš„ JDK ä¸­ï¼Œä¾‹å¦‚`C:\\Program Files\\Android\\Android Studio\\jbr\\bin\\keytool.exe`

ç„¶ååœ¨`[project]/src-tauri/gen/android/keystore.properties`ä½ç½®åˆ›å»ºæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶åŒ…å«å¯¹ä½ å¯†é’¥åº“çš„å¼•ç”¨ä¿¡æ¯

> æ³¨æ„ä½ çš„å¯†é’¥åº“å’Œ keystore.properties éƒ½åº”è¯¥æ˜¯ç§å¯†çš„

æœ€åï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ Gradle ä¸­é…ç½®ç­¾åé€‰é¡¹å³å¯

åœ¨**`[project]/src-tauri/gen/android/app/build.gradle.kts`**æ–‡ä»¶ä¸­ï¼Œæ·»åŠ å¦‚ä¸‹å¼•ç”¨

```kotlin
import java.util.Properties
import java.io.FileInputStream
```

åœ¨`buildTypes`ä»£ç å—ä¹‹å‰çš„`signingConfigs `ä¸­æ·»åŠ `release`ä»£ç å—

```kotlin
signingConfigs {
    create("release") {
        val keystorePropertiesFile = rootProject.file("keystore.properties")
        val keystoreProperties = Properties()
        if (keystorePropertiesFile.exists()) {
            keystoreProperties.load(FileInputStream(keystorePropertiesFile))
        }

        keyAlias = keystoreProperties["keyAlias"] as String
        keyPassword = keystoreProperties["keyPassword"] as String
        storeFile = file(keystoreProperties["storeFile"] as String)
        storePassword = keystoreProperties["storePassword"] as String
    }
}

buildTypes {
    ...
}
```

æœ€ååœ¨`buildTypes`å—çš„`release`ä¸­ä½¿ç”¨æ–°çš„é…ç½®

```kotlin
buildTypes {
    getByName("release") {
        signingConfig = signingConfigs.getByName("release")
    }
}
```

çœ‹ä¸Šå»å¾ˆç®€å•ï¼Œä½†æ˜¯å°±æ˜¯æœ‰ ğŸ– åˆ†ä¸æ¸…`src-tauri\gen\android\build.gradle.kts`å’Œ`src-tauri\gen\android\app\build.gradle.kts`

æ³¨æ„ç€ä¸¤ä¸ªæ–‡ä»¶åŒåä½†è·¯å¾„ä¸åŒï¼ŒåŠŸèƒ½ä¹Ÿä¸åŒ

## ä½¿ç”¨ HTTP å®¢æˆ·ç«¯æ’ä»¶

è¿™é‡Œå®˜ç½‘çš„æ–‡æ¡£è¯´çš„ä¸æ˜¯å¾ˆè¯¦ç»†

æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ JavaScript API ç‰ˆæœ¬ï¼Œé€šè¿‡

```powershell
npm run tauri add http
```

å®‰è£…æ’ä»¶

åœ¨å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œç»™å‡ºçš„é…ç½®å…è®¸è®¿é—®çš„ URL çš„é…ç½®æ–‡ä»¶å¦‚ä¸‹

```json
// src-tauri/capabilities/base.json
{
  "permissions": [
    {
      "identifier": "http:default",
      "allow": [{ "url": "https://*.tauri.app" }],
      "deny": [{ "url": "https://private.tauri.app" }]
    }
  ]
}
```

ä½†æ˜¯æˆ‘ä»¬æ‰¾åˆ°`src-tauri/capabilities`ä¸­ï¼Œå¹¶æ²¡æœ‰å‘ç°`base.json`æ–‡ä»¶

ç›´æ¥åˆ›å»ºä¸€ä¸ª`base.json`æ–‡ä»¶å¹¶ç²˜è´´ä»£ç è‚¯å®šæ˜¯é”™è¯¯çš„ï¼Œæˆ‘æŒ‰ç…§æˆ‘å¯¹ Tauri é…ç½®çš„è¯¸å¤šç†è§£è¿›è¡Œäº†ä¿®æ”¹ï¼Œä¹Ÿä¾ç„¶æŠ¥é”™

æœ€ç®€å•çš„æ–¹å¼æ˜¯ç›´æ¥åœ¨`default.json`ä¸­å¤åˆ¶ä»£ç å—

```json
{
  "$schema": "../gen/schemas/desktop-schema.json",
  "identifier": "default",
  "description": "Capability for the main window",
  "windows": ["main"],
  "permissions": [
    "core:default",
    "opener:default",
    {
      "identifier": "http:default",
      "allow": [
        {
          "url": "https://*.*"
        },
        {
          "url": "http://*.*"
        }
      ]
    }
  ]
}
```

ç„¶åå°±å¯ä»¥æ­£å¸¸ä½¿ç”¨äº†

## ä½¿ç”¨ SQL æ’ä»¶

### æ„å»ºé…ç½®

è¿™ä¸ªæ’ä»¶å®˜æ–¹çš„æ–‡æ¡£ä¹Ÿæœ‰ç‚¹å°é—®é¢˜

é¦–å…ˆï¼Œåœ¨`Cargo.toml`æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹

```
[dependencies.tauri-plugin-sql]
features = ["sqlite"] # or "postgres", or "mysql"
git = "https://github.com/tauri-apps/plugins-workspace"
branch = "v2"
```

ç„¶åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä¸‹è½½æ’ä»¶

```powershell
npm add https://github.com/tauri-apps/tauri-plugin-sql#v2
```

æˆ‘ä»¬åœ¨ Tauri ä¸­æ³¨å†Œæ’ä»¶

```rust
// src-tauri/src/main.rs
fn main() {
    tauri::Builder::default()
        .plugin(tauri_plugin_sql::Builder::default().build()) // æ³¨å†Œæ’ä»¶
        .run(tauri::generate_context!())
        .expect("error while running tauri application");
}
```

å®˜ç½‘çš„è¯´æ˜å°±åˆ°è¿™é‡Œï¼Œå®é™…ä¸Šï¼Œä½ è¿˜éœ€è¦åœ¨`src-tauri\src\lib.rs`ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç 

```rust
#[tauri::command]
fn greet(name: &str) -> String {
    format!("Hello, {}! You've been greeted from Rust!", name)
}

#[cfg_attr(mobile, tauri::mobile_entry_point)]
pub fn run() {
    tauri::Builder::default()
        .plugin(tauri_plugin_http::init())
        .plugin(tauri_plugin_opener::init())
        .plugin(tauri_plugin_sql::Builder::default().build()) // æ·»åŠ 
        .invoke_handler(tauri::generate_handler![greet])
        .run(tauri::generate_context!())
        .expect("error while running tauri application");
}
```

### ç±»å‹è½¬æ¢

ä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œæˆ‘ä»¬é€šè¿‡`execute`æ‰§è¡Œ sql è¯­å¥ï¼Œæ‹¿å›æ¥çš„ Date ç±»å‹å’Œ Boolean ç±»å‹éƒ½å˜æˆäº†å­—ç¬¦ä¸²ç±»å‹ï¼Œè€Œä¸” TypeScript å¹¶çœ‹ä¸å‡ºæ¥å˜é‡çš„å®é™…ç±»å‹ï¼Œå¯¼è‡´ç±»å‹è½¬æ¢çš„æ—¶å€™è¿˜è¦å¥—ä¸€å±‚`unkown`

```typescript
const completed = JSON.parse(rawPlan.completed as unknown as string);
```

## ä½¿ç”¨è‡ªå®šä¹‰åŠ¨æ€åº“

å…ˆ ğŸ•Š ç€
